<html>
  <head>
    <title>Mermaid Architecture diagrams</title>
    <!--
      requires "dist" folder being served at http://localhost:8000/
    -->
  </head>
  <body>
    
    <h1>Mermaid <a href="https://mermaid.js.org/syntax/architecture.html" target="_blank">Architecture</a> diagrams:</h1>

    <h2>Generic icons</h2>
    <pre class="mermaid">
      architecture-beta
         group api(cloud)[API]
    
        service db(database)[Database] in api
        service disk1(disk)[Storage] in api
        service disk2(disk)[Storage] in api
        service server(server)[Server] in api
    
        db:L -- R:server
        disk1:T -- B:server
        disk2:T -- B:db  
    </pre>

    <h2>AWS icons from iconify.design</h2>
    <pre class="mermaid">
      architecture-beta
        group api(logos:aws-lambda)[API]
    
        service db(logos:aws-aurora)[Database] in api
        service disk1(logos:aws-glacier)[Storage] in api
        service disk2(logos:aws-s3)[Storage] in api
        service server(logos:aws-ec2)[Server] in api
    
        db:L -- R:server
        disk1:T -- B:server
        disk2:T -- B:db  
    </pre>

    <h2>AWS icons from aws-icons-for-plantuml</h2>
    <pre class="mermaid">
---
config:
  theme: base
  themeVariables:
    darkMode: false
    archEdgeColor: "#232F3E"
    archEdgeArrowColor: "#232F3E"
    archGroupBorderColor: "#ED7100"
---
      architecture-beta
        group api(aws:lambda)[API]
    
        service db(aws:aurora)[Database] in api
        service disk1(aws:simple-storage-service-glacier)[Storage] in api
        service disk2(aws:simple-storage-service)[Storage] in api
        service server(aws:ec2)[Server] in api
    
        db:L <-- R:server
        disk1:T <-- B:server
        disk2:T <-- B:db  
    </pre>

    <pre class="mermaid">
---
config:
  theme: base
  themeVariables:
    darkMode: false
    archEdgeColor: "#232F3E"
    archEdgeArrowColor: "#232F3E"
    archGroupBorderColor: "#C925D1"
---
architecture-beta
  group cp(aws:codepipeline)[AWS CodePipeline]

    service gr(aws:git-repository)[Git Repository] in cp
    service cb(aws:codebuild)[AWS CodeBuild] in cp
    service cd1(aws:codedeploy)[AWS CodeDeploy] in cp
    service s3(aws:simple-storage-service)[Amazon S3 artifact store] in cp
    service user(aws:user)[Human Approval] in cp
    service dev(aws:ec2)[Amazon EC2 dev] in cp
    service cd2(aws:codedeploy)[AWS CodeDeploy] in cp
    service prod(aws:ec2)[Amazon EC2 prod] in cp
    service sns(aws:simple-notification-service)[SNS Notification] in cp

    gr:R --> L:cb
    cb:R --> L:cd1
    cb:B --> T:s3
    cd1:R --> L:user
    cd1:B --> T:dev
    user:R --> L:cd2
    cd2:B --> T:prod
    cd2:R --> L:sns
    </pre>

    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.esm.mjs';
      let baseUrl = 'http://localhost:8000';
      let icons = await fetch(`${baseUrl}/aws-icons-mermaid.json`).then((res) => res.json());
      // https://mermaid.js.org/config/icons.html
      mermaid.registerIconPacks([
        {
          name: 'logos',
          loader: () =>
            fetch('https://unpkg.com/@iconify-json/logos@1/icons.json').then((res) => res.json()),
        },
        {
          name: 'aws',
          loader: () => icons
        },
      ]);
      mermaid.initialize({ startOnLoad: true });
    </script>
  </body>
</html>